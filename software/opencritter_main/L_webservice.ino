/*
   Handles the web server, so that users can interact from the smart device over WiFi

   Look in the main ino and _setup.h for more parameters related to this
*/

void handleRoot() {

  String pageString = ""; //Send to client buffer
  String imgString = "";  //Encoded image string

  pageString = F("<!DOCTYPE html><html><head><title>OpenCritter Stats</title></head><body><center>"); //Set up a header and page info
  pageString += "<h1>";
  pageString += crittername;
  pageString += "</h1>";

  switch (breed) { //Give a different breed name and image depending on the current breed (image is sent as URI data)
    case egg:
      pageString += F("<h2>Breed: Egg</h2><img src='data:image/bmp;base64,");
      //Base64.encode(imgString, gfx_egg_main, sizeof(gfx_egg_main));
      //pageString += imgString;
      pageString += "Qk16CAAAAAAAAHoEAABsAAAAIAAAACAAAAABAAgAAAAAAAAEAAATCwAAEwsAAAABAAAAAQAAQkdScwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAAICAgADAwMABAQEAAUFBQAGBgYABwcHAAgICAAJCQkACgoKAAsLCwAMDAwADQ0NAA4ODgAPDw8AEBAQABEREQASEhIAExMTABQUFAAVFRUAFhYWABcXFwAYGBgAGRkZABoaGgAbGxsAHBwcAB0dHQAeHh4AHx8fACAgIAAhISEAIiIiACMjIwAkJCQAJSUlACYmJgAnJycAKCgoACkpKQAqKioAKysrACwsLAAtLS0ALi4uAC8vLwAwMDAAMTExADIyMgAzMzMANDQ0ADU1NQA2NjYANzc3ADg4OAA5OTkAOjo6ADs7OwA8PDwAPT09AD4+PgA/Pz8AQEBAAEFBQQBCQkIAQ0NDAERERABFRUUARkZGAEdHRwBISEgASUlJAEpKSgBLS0sATExMAE1NTQBOTk4AT09PAFBQUABRUVEAUlJSAFNTUwBUVFQAVVVVAFZWVgBXV1cAWFhYAFlZWQBaWloAW1tbAFxcXABdXV0AXl5eAF9fXwBgYGAAYWFhAGJiYgBjY2MAZGRkAGVlZQBmZmYAZ2dnAGhoaABpaWkAampqAGtrawBsbGwAbW1tAG5ubgBvb28AcHBwAHFxcQBycnIAc3NzAHR0dAB1dXUAdnZ2AHd3dwB4eHgAeXl5AHp6egB7e3sAfHx8AH19fQB+fn4Af39/AICAgACBgYEAgoKCAIODgwCEhIQAhYWFAIaGhgCHh4cAiIiIAImJiQCKiooAi4uLAIyMjACNjY0Ajo6OAI+PjwCQkJAAkZGRAJKSkgCTk5MAlJSUAJWVlQCWlpYAl5eXAJiYmACZmZkAmpqaAJubmwCcnJwAnZ2dAJ6engCfn58AoKCgAKGhoQCioqIAo6OjAKSkpAClpaUApqamAKenpwCoqKgAqampAKqqqgCrq6sArKysAK2trQCurq4Ar6+vALCwsACxsbEAsrKyALOzswC0tLQAtbW1ALa2tgC3t7cAuLi4ALm5uQC6uroAu7u7ALy8vAC9vb0Avr6+AL+/vwDAwMAAwcHBAMLCwgDDw8MAxMTEAMXFxQDGxsYAx8fHAMjIyADJyckAysrKAMvLywDMzMwAzc3NAM7OzgDPz88A0NDQANHR0QDS0tIA09PTANTU1ADV1dUA1tbWANfX1wDY2NgA2dnZANra2gDb29sA3NzcAN3d3QDe3t4A39/fAODg4ADh4eEA4uLiAOPj4wDk5OQA5eXlAObm5gDn5+cA6OjoAOnp6QDq6uoA6+vrAOzs7ADt7e0A7u7uAO/v7wDw8PAA8fHxAPLy8gDz8/MA9PT0APX19QD29vYA9/f3APj4+AD5+fkA+vr6APv7+wD8/PwA/f39AP7+/gD///8A////////////////AAAAAAAAAP////////////////////////////8AAAAA/wD/AP8AAAAA////////////////////////AAD//wD//wD/AP8A/wAA/////////////////////wAA//////8A/wD/AP8A/wAA//////////////////8AAP//////////////AP8A/wAA////////////////AAD//////////////wD/AP8A/wAA/////////////wAA////////////////////AP8A/wAA////////////AP//////////////////////AP8A/wD///////////8A/////////////////////wD/AP8AAP//////////AAD/////////////////////////AP8AAP////////8A/////////////////////////wD/AP8A/////////wD/////////////////////////////AAD/////////AP///////////////////////////wD/AP////////8A//////////////////////////////8A/////////wD/////////////////////////////AAD/////////AAD///////////////////////////8AAP//////////AP///////////////////////////wD///////////8A////////////////////////////AP///////////wD///////////////////////////8A////////////AAD/////////////////////////AAD/////////////AP////////////////////////8A//////////////8A/////////////////////////wD//////////////wAA//////////////////////8AAP///////////////wAA////////////////////AAD//////////////////wD///////////////////8A////////////////////AAD/////////////////AAD/////////////////////AP////////////////8A//////////////////////8AAP//////////////AAD///////////////////////8AAP///////////wAA//////////////////////////8AAP////////8AAP////////////////////////////8AAP//////AAD///////////////////////////////8AAAAAAAAA/////////////////w==";
      pageString += F("'>");
      break;
    case wibbur:
      pageString += F("<h2>Breed: Wibbur</h2><img src='data:image/bmp;base64,Qk2KEAAAAAAAAIoAAAB8AAAAIAAAACAAAAABACAAAwAAAAAQAAATCwAAEwsAAAAAAAAAAAAAAAAA/wAA/wAA/wAA/wAAAEJHUnMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAA////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAA/wAAAP8AAAD/AAAA/wAAAP///////////////////////////////////////////////////////////////////////////////////////////////////////////wAAAP8AAAD/AAAA/wAAAP8AAAD//////wAAAP///////////////////////////wAAAP///////////////////////////wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD///////////////////////////8AAAD///////////////////////////8AAAD/AAAA/////////////////////////////////wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/////////////////////////////////wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/////////////////////////////////wAAAP//////AAAA/wAAAP//////////////////////////////////////AAAA/wAAAP///////////////////////////////////////////wAAAP8AAAD//////////////////////////////////////wAAAP8AAAD//////////////////////wAAAP///////////////////////////wAAAP////////////////////////////////////////////////////////////////8AAAD///////////////////////////8AAAD/////////////////////////////////AAAA/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wAAAP//////////////////////////////////////AAAA//////////////////////////////////////////////////////8AAAD/AAAA//////////////////////////////////////////////////////8AAAD///////////////////////////////////////////8AAAD/////////////////////////////////////////////////AAAA/wAAAP8AAAD/AAAA/////////////////////////////////////////////////wAAAP////////////////////////////////////////////////8AAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////8AAAD//////////////////////////////////////////////////////wAAAP///////////////////////////////////////////////////////////////////////////////////////////////////////////wAAAP//////////////////////////////////////////////////////AAAA////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAA//////////////////////////////////////////////////////8AAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////8AAAD//////////////////////////////////////////////////////wAAAP///////////////////////////////////////////////////////////////////////////////////////////////////////////wAAAP//////////////////////////////////////////////////////AAAA/////////////////////////////////wAAAP//////////////////////////////////////AAAA////////////////////////////AAAA//////////////////////////////////////////////////////8AAAD///////////////////////////8AAAD/AAAA/wAAAP///////////////////////////wAAAP8AAAD/AAAA//////////////////////8AAAD//////////////////////////////////////////////////////wAAAP8AAAD///////////////////////////8AAAD//////////////////////////////////////wAAAP//////////////////////AAAA/wAAAP///////////////////////////////////////////////////////////wAAAP////////////////////////////////////////////////////////////////////////////////////////////////8AAAD/////////////////////////////////////////////////////////////////AAAA/wAAAP///////////wAAAP///////////////////////////////////////////////////////////wAAAP//////AAAA/wAAAP//////////////////////////////////////////////////////////////////////AAAA/////////////////wAAAP8AAAD/AAAA////////////////////////////AAAA/wAAAP8AAAD///////////8AAAD///////////////////////////////////////////////////////////////////////////8AAAD/AAAA////////////////////////////////////////////////////////////////////////////AAAA/wAAAP////////////////////////////////////////////////////////////////////////////////8AAAD/AAAA/wAAAP//////////////////////////////////////////////////////AAAA/wAAAP8AAAD/////////////////////////////////////////////////////////////////////////////////////////////////AAAA/wAAAP8AAAD/////////////////////////////////AAAA/wAAAP8AAAD//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wAAAP8AAAD//////////////////////wAAAP8AAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8AAAD/AAAA/wAAAP8AAAD//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////w=='>");
      break;
    case snek:
      pageString += F("<h2>Breed: Snek</h2><img src='data:image/bmp;base64,Qk2KEAAAAAAAAIoAAAB8AAAAIAAAACAAAAABACAAAwAAAAAQAAATCwAAEwsAAAAAAAAAAAAAAAAA/wAA/wAA/wAA/wAAAEJHUnMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wAAAP8AAAD/AAAA/wAAAP////////////////////////////////////////////////////////////////8AAAD/AAAA/wAAAP8AAAD//////////////////////////////////////////////////////wAAAP8AAAD//////////////////////wAAAP8AAAD///////////////////////////////////////////8AAAD/AAAA//////////////////////8AAAD///////////////////////////////////////////8AAAD///////////////////////////////////////////8AAAD/////////////////////////////////AAAA//////////////////////////////////////8AAAD/////////////////////////////////AAAA//////////////////////8AAAD/AAAA//////////////////////8AAAD//////////////////////wAAAP//////////////////////AAAA//////////////////////8AAAD///////////////////////////8AAAD/////////////////AAAA////////////AAAA/////////////////wAAAP//////////////////////AAAA/////////////////wAAAP//////AAAA/////////////////wAAAP///////////////////////////wAAAP///////////wAAAP//////////////////////AAAA////////////AAAA//////////////////////8AAAD///////////8AAAD/////////////////AAAA////////////AAAA////////////////////////////AAAA////////////AAAA//////////////////////8AAAD///////////8AAAD//////////////////////wAAAP///////////wAAAP////////////////8AAAD///////////8AAAD///////////////////////////8AAAD///////////8AAAD//////////////////////wAAAP////////////////8AAAD///////////8AAAD/////////////////AAAA/////////////////wAAAP///////////wAAAP///////////////////////////wAAAP///////////wAAAP//////////////////////AAAA//////////////////////8AAAD/AAAA//////////////////////8AAAD/////////////////AAAA////////////AAAA//////////////////////8AAAD/////////////////AAAA////////////////////////////AAAA////////////////////////////////////////////AAAA//////////////////////8AAAD//////wAAAP///////////////////////////wAAAP///////////wAAAP//////////////////////////////////////AAAA/////////////////////////////////wAAAP///////////////////////////wAAAP//////AAAA////////////////////////////AAAA////////////AAAA////////////////////////////////////////////AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/////////////////////////////////AAAA//////8AAAD///////////////////////////8AAAD///////////8AAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////8AAAD//////wAAAP///////////////////////////wAAAP///////////wAAAP///////////////////////////////////////////////////////////////////////////////////////////////////////////wAAAP8AAAD/////////////////////////////////AAAA////////////AAAA//////////////////////8AAAD/AAAA/wAAAP8AAAD/AAAA/////////////////////////////////////////////////////////////////wAAAP////////////////////////////////8AAAD///////////8AAAD/////////////////AAAA////////////////////////////AAAA////////////////////////////////////////////////////////////AAAA/////////////////////////////////wAAAP////////////////8AAAD//////wAAAP//////////////////////////////////////AAAA////////////////////////////////////////////////////////////////////////////////////////////AAAA//////////////////////8AAAD///////////////////////////////////////////8AAAD/////////////////////////////////////////////////////////////////////////////////////////////////AAAA/////////////////////////////////wAAAP///////////////////////////wAAAP//////////////////////////////////////////////////////////////////////////////////////////////////////AAAA////////////////////////////////////////////AAAA//////8AAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAA/////////////////////////////////////////////////wAAAP//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAA//////////////////////////////////////8AAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////w=='>");
      break;
    case tribbur:
      pageString += F("<h2>Breed: Tribbur</h2><img src='data:image/bmp;base64,Qk2KEAAAAAAAAIoAAAB8AAAAIAAAACAAAAABACAAAwAAAAAQAAATCwAAEwsAAAAAAAAAAAAAAAAA/wAA/wAA/wAA/wAAAEJHUnMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8AAAD/AAAA/////////////////////////////////wAAAP8AAAD/////////////////////////////////////////////////////////////////////////////////////////////////AAAA/wAAAP8AAAD/AAAA////////////AAAA//////////////////////8AAAD///////////8AAAD/AAAA/wAAAP8AAAD/////////////////////////////////////////////////////////////////AAAA/wAAAP////////////////////////////////8AAAD//////////////////////wAAAP////////////////////////////////8AAAD/AAAA/////////////////////////////////////////////////wAAAP////////////////////////////////////////////////8AAAD///////////8AAAD/////////////////////////////////////////////////AAAA//////////////////////////////////////8AAAD//////////////////////////////////////////////////////wAAAP///////////wAAAP//////////////////////////////////////////////////////AAAA////////////////////////////AAAA////////////////////////////////////////////////////////////AAAA////////////AAAA////////////////////////////////////////////////////////////AAAA//////////////////////8AAAD//////wAAAP8AAAD//////////////////////////////////////wAAAP//////////////////////AAAA//////////////////////////////////////8AAAD/AAAA//////8AAAD//////////////////////wAAAP//////AAAA//////8AAAD///////////////////////////8AAAD/////////////////////////////////AAAA////////////////////////////AAAA//////8AAAD//////wAAAP//////////////////////AAAA//////8AAAD//////wAAAP///////////////////////////wAAAP////////////////////////////////8AAAD///////////////////////////8AAAD//////wAAAP//////AAAA//////////////////////8AAAD//////wAAAP//////AAAA////////////////////////////AAAA/////////////////////////////////wAAAP///////////////////////////wAAAP//////AAAA//////8AAAD//////////////////////wAAAP///////////wAAAP8AAAD///////////////////////////8AAAD/////////////////////////////////AAAA////////////////////////////AAAA/wAAAP///////////wAAAP//////////////////////AAAA////////////AAAA//////8AAAD//////////////////////wAAAP////////////////////////////////8AAAD//////////////////////wAAAP//////AAAA////////////AAAA////////////////////////////AAAA//////8AAAD//////wAAAP///////////////////////////wAAAP//////////////////////AAAA////////////////////////////AAAA//////8AAAD//////wAAAP////////////////////////////////8AAAD//////wAAAP//////AAAA/////////////////////////////////wAAAP8AAAD/AAAA/wAAAP////////////////////////////////8AAAD//////wAAAP//////AAAA//////////////////////////////////////8AAAD//////wAAAP//////AAAA////////////////////////////////////////////////////////////////////////////AAAA//////8AAAD//////wAAAP///////////////////////////////////////////wAAAP//////AAAA////////////AAAA/////////////////////////////////////////////////////////////////wAAAP///////////wAAAP//////AAAA/////////////////////////////////wAAAP8AAAD///////////8AAAD/////////////////AAAA//////////////////////////////////////////////////////8AAAD/////////////////AAAA////////////AAAA/wAAAP//////////////////////AAAA////////////AAAA////////////////////////////AAAA/wAAAP////////////////////////////////8AAAD/AAAA////////////////////////////AAAA////////////AAAA////////////////////////////AAAA/wAAAP///////////////////////////wAAAP///////////wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA////////////AAAA////////////////////////////AAAA/wAAAP////////////////////////////////////////////////////////////////8AAAD//////////////////////wAAAP///////////wAAAP//////////////////////AAAA/////////////////////////////////////////////////////////////////////////////////////////////////wAAAP//////AAAA/wAAAP//////AAAA////////////AAAA//////8AAAD/AAAA//////8AAAD/////////////////////////////////////////////////////////////////////////////////////////////////AAAA//////8AAAD/AAAA//////8AAAD///////////8AAAD//////wAAAP8AAAD//////wAAAP////////////////////////////////////////////////////////////////////////////////////////////////8AAAD//////////////////////wAAAP///////////wAAAP//////////////////////AAAA//////////////////////////////////////////////////////////////////////////////////////////////////////8AAAD/AAAA/wAAAP8AAAD//////////////////////wAAAP8AAAD/AAAA/wAAAP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////w=='>");
      break;
    default:
      break;
  }

  pageString += F("<table border='1'><tr><td colspan='2'><b>Stats</b></td><td colspan='2'><b>Traits</b></td><td colspan='2'><b>BioSpecs</b></td></tr><tr><td>Hunger</td><td>");
  pageString += hun;
  pageString += F("</td><td>Athleticism</td><td>");
  pageString += Ath;
  pageString += F("</td><td>Energy</td><td>");
  pageString += NRG;
  pageString += F("</td></tr><tr><td>Happiness</td><td>");
  pageString += hap;
  pageString += F("</td><td>Discipline</td><td>");
  pageString += Dis;
  pageString += F("</td><td>Metabolism</td><td>");
  pageString += metabolism;
  pageString += F("</td></tr><tr><td>Boredom</td><td>");
  pageString += bor;
  pageString += F("</td><td>Intelligence</td><td>");
  pageString += Int;
  pageString += F("</td><td>Weight</td><td>");
  pageString += weight;
  pageString += F("</td></tr></table>");



  for (int i = 0; i < server.args(); i++) { //For each argument the user passed us
    if (server.argName(i) == "name") { //If the user is trying to change the critter name
      crittername = server.arg(i); // Change the critter name to the argument value
    }
    if (server.argName(i) == "beep") { //If the argument name was "beep"
      beep(server.arg(i).toInt()); //Convert the value to an integer, and play that beep mode
    }
    if (server.argName(i) == "maxhealth") { //If the user wants to max the params
      hun = 255;
      hap = 255;
      bor = 255;
      Ath = 100;
      Dis = 100;
      Int = 100;
      NRG = 100;
    }
    if (server.argName(i) == "kill") { //If the user wants to max the params
      deadcritter = true;
      beep(beep_DnChirp);
      display.clearDisplay();
      for (int i = 0; i < 32; i++) {
        display.drawBitmap(i * 16, (i / 8) * 16, gfx_icon_sick, 16, 16, 1); //Show alert icon
      }
      display.display();
    }
  }

  pageString += F("<form action='' method='get'>Name: <input type='text' name='name'><input type='submit' value='Send'></form>"); // Input critter name
  pageString += F("<form action='' method='get'>Beep: <input type='text' name='beep'><input type='submit' value='Send'></form>"); // Send a beepmode
  pageString += F("<form action='' method='get'>Max Health: <input type='submit' name='maxhealth' value='maxhealth'></form>");
  pageString += F("<form action='' method='get'>KILL!: <input type='submit' name='kill' value='kill'></form>");
  pageString += F("</center></body></html>"); //Zip up the body and html and get ready to send
  server.send(200, "text / html", pageString); //Send the page buffer
}
